<%- include('../template/head')-%>

<body class="text-center">
    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <%- include('../template/nav')-%>
        <h1 class="cover-heading py-1 mb-1">Investor Table</h1>

        <!-- Bootstrap Card Container -->
        <div class="container">
            <div class="card shadow-sm">
                <div class="card-body">
                    <!-- Search Bar for Filtering -->
                    <div class="mb-4">
                        <input
                            type="text"
                            id="tableFilter"
                            class="form-control"
                            placeholder="Search by any column..."
                            aria-label="Search Table"
                        />
                    </div>

                    <!-- Table -->
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col" data-sort="id" class="sortable">ID</th>
                                    <th scope="col" data-sort="name" class="sortable">Last Name, First Name</th>
                                    <th scope="col" data-sort="stocks" class="sortable">Stocks</th>
                                    <th scope="col" data-sort="bonds" class="sortable">Bonds</th>
                                    <th scope="col" data-sort="activity" class="sortable">Current Activity</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <% table.forEach(function(entry) { %>
                                <tr>
                                    <td><%= entry.id %></td> <!--NO ID-->
                                    <td><%= entry.lastName %>, <%= entry.firstName %></td>
                                    <td><%= entry.stocks %></td>
                                    <td><%= entry.bonds %></td>
                                    <td><%= entry.activity %></td>
                                </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <%- include('../template/footer')-%>
    </div>

    <!-- JavaScript for Filtering and Sorting -->
    <script>
        // Filtering Functionality
        document.getElementById('tableFilter').addEventListener('input', function () {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => {
                const cells = Array.from(row.getElementsByTagName('td'));
                const matches = cells.some(cell => cell.textContent.toLowerCase().includes(filter));
                row.style.display = matches ? '' : 'none';
            });
        });

        // Sorting Functionality
        document.querySelectorAll('.sortable').forEach(header => {
            header.addEventListener('click', () => {
                const sortKey = header.getAttribute('data-sort');
                const rows = Array.from(document.querySelectorAll('#tableBody tr'));
                const isAscending = header.classList.toggle('asc');
                header.classList.toggle('desc', !isAscending);

                rows.sort((rowA, rowB) => {
                    const cellA = rowA.querySelector(`td:nth-child(${header.cellIndex + 1})`).textContent.trim();
                    const cellB = rowB.querySelector(`td:nth-child(${header.cellIndex + 1})`).textContent.trim();

                    return isAscending
                        ? cellA.localeCompare(cellB, undefined, { numeric: true })
                        : cellB.localeCompare(cellA, undefined, { numeric: true });
                });

                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = '';
                rows.forEach(row => tableBody.appendChild(row));
            });
        });

        window.onload = function () {
            document.getElementById('table').classList.add('active');
        };
    </script>
</body>
</html>
