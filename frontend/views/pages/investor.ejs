<%- include('../template/head')-%>

<script>
    function sendInvestorId() {
        const dropdown = document.getElementById('investorDropdown');
        const selectedValue = dropdown.value;

        if (!selectedValue) {
            alert('Please select an investor first!');
            return;
        }

        // Make a POST request using fetch
        fetch('/api/investor', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ investorId: selectedValue }),
        })
        .then((response) => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then((data) => {
            alert(`Server response: ${data.message}`);
            // Redirect to the portfolio page
            window.location.href = '/portfolio';
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }

    function handleInvestorSelection() {
    const dropdown = document.getElementById('investorDropdown');
    const selectedValue = dropdown.value; // The selected investor's ID
    const selectedText = dropdown.options[dropdown.selectedIndex].text; // The selected investor's name

    // Store the selected investor ID in localStorage
    localStorage.setItem('selectedInvestorId', selectedValue);

    // Store the selected investor's name in localStorage
    localStorage.setItem('selectedInvestor', selectedText);

    // Update the display to show the selected investor
    document.getElementById('selectedInvestorId').innerText = `Selected ID: ${selectedValue} (${selectedText})`;
}


    // Send the ID in the body to the server for the edit investor action
    function redirectToEditInvestor() {
        const dropdown = document.getElementById('investorDropdown');
        const selectedValue = dropdown.value;

        if (!selectedValue) {
            alert('Please select an investor first!');
            return;
        }

        // Make a POST request using fetch
        fetch('/api/investor', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ investorId: selectedValue }),
        })
        .then((response) => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then((data) => {
            alert(`Server response: ${data.message}`);
            // Redirect to the editinvestor page
            window.location.href = '/editinvestor';
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }

</script>

<body class="text-center">
    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <%- include('../template/nav')-%>
        <main role="main" class="inner cover">
            <h1 class="cover-heading">Investor Dropdown</h1>
            <select id="investorDropdown" class="form-select" onchange="handleInvestorSelection()">
                <option value="" disabled selected>Select an Investor</option>
                <% if(locals.investorArray) { %>
                    <% investorArray.forEach(function(investor) { %>
                        <option value="<%= investor.id %>">
                            <%= investor.firstname %> <%= investor.lastname %>
                        </option>
                    <% }); %>
                <% } %>
            </select>
            <p id="selectedInvestorId" class="mt-3"></p>
            
            <!-- Submit Button -->
            <button id="sendInvestorId" class="btn btn-primary mt-3" onclick="sendInvestorId()">View Portfolio</button>
            
            <!-- New Edit Button -->
            <button id="editInvestor" class="btn btn-secondary mt-3" onclick="redirectToEditInvestor()">Edit Investor</button>
        </main>
        <%- include('../template/footer')-%>
    </div>
</body>

</html>
